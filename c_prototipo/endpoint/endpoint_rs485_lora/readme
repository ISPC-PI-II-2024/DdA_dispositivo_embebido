üå°Ô∏è Endpoint ESP32-C3 - Sistema RS485 a LoRa
<div align="center">
https://img.shields.io/badge/ESP32--C3-RISC--V-red?style=for-the-badge&logo=espressif
https://img.shields.io/badge/Protocolo-RS485-blue?style=for-the-badge
https://img.shields.io/badge/Comunicaci%C3%B3n-LoRa-green?style=for-the-badge
https://img.shields.io/badge/PlatformIO-IDE-orange?style=for-the-badge&logo=visualstudiocode

Sistema maestro de recolecci√≥n y transmisi√≥n de datos ambientales

</div>
üìã Tabla de Contenidos
üéØ Descripci√≥n

üèóÔ∏è Arquitectura

üîß Caracter√≠sticas

‚ö° Instalaci√≥n R√°pida

üîå Conexiones

üì° Protocolo

üîÑ Funcionamiento

üöÄ Uso

üêõ Soluci√≥n de Problemas

üîß Desarrollo

üéØ Descripci√≥n
El Endpoint ESP32-C3 act√∫a como el cerebro central del sistema de monitoreo, recolectando datos de m√∫ltiples sensores ESP8266 via RS485 y transmiti√©ndolos de forma inal√°mbrica via LoRa a un Gateway central.

üí° Analog√≠a Simple

üîÑ CICLO AUTOM√ÅTICO (2 minutos):

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üîç ‚îÇ ‚îÇ üå°Ô∏è ‚îÇ ‚îÇ üì° ‚îÇ ‚îÇ üí§ ‚îÇ
‚îÇ DISCOVERY ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ LECTURA ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ TRANSMISI√ìN ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ ESPERA ‚îÇ
‚îÇ 10 seg ‚îÇ ‚îÇ 30 seg ‚îÇ ‚îÇ 15 seg ‚îÇ ‚îÇ 65 seg ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚ñ≤ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

üèóÔ∏è Arquitectura
Diagrama del Sistema
text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    RS485    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    LoRa     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ESP8266       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   ESP32-C3      ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   Gateway       ‚îÇ
‚îÇ  + AHT10        ‚îÇ             ‚îÇ   Endpoint      ‚îÇ             ‚îÇ   ESP32         ‚îÇ
‚îÇ  (Sensor 01)    ‚îÇ             ‚îÇ                 ‚îÇ             ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                               ‚îÇ                               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                      ‚îÇ                               ‚îÇ
‚îÇ   ESP8266       ‚îÇ                      ‚îÇ                               ‚îÇ
‚îÇ  + AHT10        ‚îÇ                      ‚îÇ                               ‚îÇ
‚îÇ  (Sensor 02)    ‚îÇ                      ‚îÇ                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                      ‚îÇ                               ‚îÇ
                                         ‚ñº                               ‚ñº
                                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                ‚îÇ   MAX485        ‚îÇ             ‚îÇ   SX1278        ‚îÇ
                                ‚îÇ   (RS485)       ‚îÇ             ‚îÇ   (LoRa)        ‚îÇ
                                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
üîß Caracter√≠sticas
‚úÖ Funcionalidades Principales
üîÑ Ciclo Autom√°tico cada 2 minutos (configurable)

üîç Auto-descubrimiento de sensores conectados

üìä Recolecci√≥n Centralizada de datos ambientales

üì° Transmisi√≥n LoRa de largo alcance

üîí Protocolo Robustecido con estructura de datos

üéØ Especificaciones T√©cnicas
Par√°metro	Especificaci√≥n
Microcontrolador	ESP32-C3 (RISC-V)
Comunicaci√≥n Local	RS485 (hasta 32 dispositivos)
Comunicaci√≥n Remota	LoRa 433MHz (SF7, BW125)
Alimentaci√≥n	3.3V DC
Consumo	~120mA en operaci√≥n
‚ö° Instalaci√≥n R√°pida
Prerrequisitos
PlatformIO IDE (extensi√≥n VS Code)

ESP32-C3-DevKitM-1

M√≥dulo MAX485 (RS485)

M√≥dulo SX1278 (LoRa)

1. Clonar y Configurar
# Crear proyecto en PlatformIO
Project Name: endpoint_rs485_lora
Board: Espressif ESP32-C3-DevKitM-1
Framework: Arduino

2. Configurar platformio.ini
[env:esp32-c3-devkitm-1]
platform = espressif32
board = esp32-c3-devkitm-1
framework = arduino
monitor_speed = 115200

lib_deps = 
    sandeepmistry/LoRa
    bblanchon/ArduinoJson

    3. Implementar C√≥digo
Copiar el contenido de src/main.cpp con el c√≥digo proporcionado.

üîå Conexiones
Diagrama de Pines ESP32-C3

       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ  ESP32-C3    ‚îÇ
       ‚îÇ  DevKitM-1   ‚îÇ
 3V3 ‚îÄ‚îÄ‚î§ ‚óØ         ‚óØ  ‚îÇ‚îÄ‚îÄ 5V
  IO4 ‚îÄ‚îÄ‚î§ ‚óØ  RO    ‚óØ  ‚îÇ‚îÄ‚îÄ IO5  ‚îÄ‚îÄ DI
  IO6 ‚îÄ‚îÄ‚î§ ‚óØ DE/RE  ‚óØ  ‚îÇ‚îÄ‚îÄ IO7  ‚îÄ‚îÄ CS
  IO8 ‚îÄ‚îÄ‚î§ ‚óØ  RST   ‚óØ  ‚îÇ‚îÄ‚îÄ IO9  ‚îÄ‚îÄ DIO0
  IO2 ‚îÄ‚îÄ‚î§ ‚óØ  SCK   ‚óØ  ‚îÇ‚îÄ‚îÄ IO3  ‚îÄ‚îÄ MISO
  GND ‚îÄ‚îÄ‚î§ ‚óØ         ‚óØ  ‚îÇ‚îÄ‚îÄ RST
       ‚îÇ              ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

       Tabla de Conexiones Detallada

üîó Conexiones RS485 (MAX485)
M√≥dulo MAX485	ESP32-C3	Funci√≥n	Color Recomendado
RO	GPIO4	Recepci√≥n	Amarillo
DI	GPIO5	Transmisi√≥n	Verde
DE/RE	GPIO6	Control	Azul
VCC	3.3V	Alimentaci√≥n	Rojo
GND	GND	Tierra	Negro

üì° Conexiones LoRa (SX1278)
M√≥dulo LoRa	ESP32-C3	Funci√≥n	Protocolo
SCK	GPIO2	Clock SPI	SPI
MISO	GPIO3	Master In Slave Out	SPI
MOSI	GPIO4	Master Out Slave In	SPI
CS	GPIO7	Chip Select	SPI
RST	GPIO8	Reset	Digital
DIO0	GPIO9	Interrupci√≥n	Digital

üì° Protocolo de Comunicaci√≥n
Estructura de Mensajes RS485

üîç Comando DISCOVERY (Descubrimiento)
Endpoint ‚Üí Sensores:
ADDR:BROADCAST|CMD:DISCOVERY

Sensor ‚Üí Endpoint:
ADDR:01|CMD:DISCOVERY_RESP|TYPE:AHT10_SENSOR|LOC:Silo_Norte|STATUS:READY|TEMP:25.5|HUM:60.2

üå°Ô∏è Comando READ_SENSOR (Lectura)
Endpoint ‚Üí Sensor:
ADDR:01|CMD:READ_SENSOR

Sensor ‚Üí Endpoint:
ADDR:01|CMD:SENSOR_DATA|TEMP:25.5|HUM:60.2|UNIT_TEMP:C|UNIT_HUM:%|TIMESTAMP:123456789

Estructura JSON LoRa
{
  "endpoint_id": "EP01",
  "timestamp": 123456789,
  "dispositivos_activos": 3,
  "total_sensores": 3,
  "sensores": [
    {
      "address": "01",
      "type": "AHT10_SENSOR",
      "location": "Silo_Norte",
      "temperature": 25.5,
      "humidity": 60.2,
      "status": "ACTIVE",
      "last_update": 123456789
    }
  ]
}

üîÑ Funcionamiento
‚è∞ Ciclo Autom√°tico (2 minutos)

üîÑ CICLO AUTOM√ÅTICO (2 minutos):

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üîç ‚îÇ ‚îÇ üå°Ô∏è ‚îÇ ‚îÇ üì° ‚îÇ ‚îÇ üí§ ‚îÇ
‚îÇ DISCOVERY ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ LECTURA ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ TRANSMISI√ìN ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ ESPERA ‚îÇ
‚îÇ 10 seg ‚îÇ ‚îÇ 30 seg ‚îÇ ‚îÇ 15 seg ‚îÇ ‚îÇ 65 seg ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚ñ≤ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Fase 1: üîç Discovery (10 segundos)
Broadcast a todos los dispositivos

Registro de sensores activos

Actualizaci√≥n de lista de dispositivos

Fase 2: üå°Ô∏è Lectura (30 segundos)
Consulta individual a cada sensor

Recolecci√≥n de temperatura y humedad

Validaci√≥n de datos recibidos

Fase 3: üì° Transmisi√≥n (15 segundos)
Estructuraci√≥n de datos en JSON

Transmisi√≥n via LoRa al Gateway

Confirmaci√≥n de env√≠o exitoso

Fase 4: üí§ Espera (65 segundos)
Procesamiento de comandos entrantes

Preparaci√≥n para pr√≥ximo ciclo

Monitoreo de estado del sistema

üöÄ Uso
Inicializaci√≥n del Sistema

void setup() {
  // 1. Inicializar comunicaci√≥n serial
  // 2. Configurar pines RS485
  // 3. Inicializar m√≥dulo LoRa
  // 4. Iniciar ciclo autom√°tico
}

Monitorizaci√≥n en Tiempo Real

pio device monitor

Salida Esperada:
üöÄ ENDPOINT ESP32-C3 - INICIANDO
üìç ID: EP01 | üì° Modo: RS485 Maestro ‚Üí LoRa
‚úÖ RS485 INICIALIZADO | ‚úÖ LoRa CONFIGURADO

üîç INICIANDO DESCUBRIMIENTO...
üì§ RS485 >>> ADDR:BROADCAST|CMD:DISCOVERY
üì• RS485 <<< ADDR:01|CMD:DISCOVERY_RESP...
üîç Sensor descubierto: 01 - Silo_Norte

üå°Ô∏è INICIANDO LECTURA...
üìñ Leyendo sensor: 01 - Silo_Norte
üì• RS485 <<< ADDR:01|CMD:SENSOR_DATA...
üå°Ô∏è Datos actualizados: 01 - Temp: 25.5¬∞C, Hum: 60.2%

üì° ENVIANDO POR LoRa...
‚úÖ Datos enviados - Sensores: 1
üí§ CICLO COMPLETADO - Esperando pr√≥ximo ciclo...

Comandos de Depuraci√≥n
En el Monitor Serial, puedes enviar:
TEST:DISCOVERY    # Forzar descubrimiento
TEST:READ_ALL     # Forzar lectura de sensores
TEST:STATUS       # Estado del sistema

üêõ Soluci√≥n de Problemas
Error: No Detecta Sensores
S√≠ntomas:

Mensaje "‚úÖ Descubrimiento completado - Dispositivos: 0"

Sin respuestas RS485 en el monitor

Soluci√≥n:

Verificar alimentaci√≥n de m√≥dulo MAX485 (3.3V)

Confirmar conexiones RO/DI/DE-RE

Probar con un solo sensor primero

Verificar terminaci√≥n de bus RS485

Error: Fallo LoRa
S√≠ntomas:

Mensaje "‚ùå Error iniciando LoRa!"

No se env√≠an datos por radio

Soluci√≥n:

Revisar conexiones SPI (SCK, MISO, MOSI, CS)

Confirmar configuraci√≥n de pines LoRa

Verificar antena conectada

Probar con otro m√≥dulo LoRa

Error: Ciclo No Avanza
Soluci√≥n:

Revisar constantes de tiempo en el c√≥digo

Verificar que millis() no se resetea

Monitorizar variables de estado del ciclo

üîß Desarrollo
Estructura del Proyecto

endpoint_rs485_lora/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ main.cpp                 # C√≥digo principal
‚îú‚îÄ‚îÄ lib/                         # Librer√≠as adicionales
‚îú‚îÄ‚îÄ include/                     # Archivos de cabecera
‚îú‚îÄ‚îÄ test/                        # Pruebas unitarias
‚îú‚îÄ‚îÄ platformio.ini              # Configuraci√≥n PlatformIO
‚îî‚îÄ‚îÄ README.md                   # Este archivo

Personalizaci√≥n
// üîß CONFIGURACI√ìN MODIFICABLE
#define ENDPOINT_ID "EP01"              // Identificador √∫nico
#define CICLO_COMPLETO 120000           // Duraci√≥n ciclo (ms)
#define DESCUBRIMIENTO 10000            // Tiempo discovery (ms)
#define LECTURA_SENSORES 30000          // Tiempo lectura (ms)
#define ENVIO_LORA 15000                // Tiempo transmisi√≥n (ms)

Pr√≥ximas Mejoras
üîã Modo bajo consumo entre ciclos

üìä M√©tricas de calidad de se√±al

üîÑ Actualizaci√≥n de firmware OTA

‚öôÔ∏è Configuraci√≥n remota de par√°metros

üë• Contribuci√≥n
Fork el proyecto

Crear feature branch (git checkout -b feature/nuevaFuncionalidad)

Commit cambios (git commit -am 'Add nueva funcionalidad')

Push al branch (git push origin feature/nuevaFuncionalidad)

Abrir Pull Request

üìû Soporte
üìã Issues: GitHub Issues

üìß Email: equipo.telecomunicaciones@instituto.edu

üí¨ Discord: Servidor del Proyecto

üìù Licencia
Distribuido bajo licencia MIT. Ver LICENSE para m√°s informaci√≥n.

